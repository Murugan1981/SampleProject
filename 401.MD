This is the most common issue in API testing. **401 means "Who are you?"**

The server is rejecting your requests because we are sending them "naked"â€”without any ID card (Token or Cookie). Since you are likely testing an internal application, it requires authentication.

Here is the solution to fix the **401 Unauthorized** error.

### Step 1: Get your "ID Card" (Token/Cookie)

We need to steal the valid credentials from your browser.

1. Open Chrome and go to the **Swagger UI** (the one that works).
2. Press **F12** to open Developer Tools.
3. Go to the **Network** tab.
4. Refresh the page or click "Try it out" on any endpoint.
5. Click on the request name (e.g., `calc` or `data`).
6. Look at the **"Request Headers"** section.
7. Find **Authorization** (usually starts with `Bearer ...`) OR **Cookie** (usually a long string).
8. **Copy the value.**

---

### Step 2: Add it to `.env`

Open your `.env` file and add a new line for the token.

**Option A: If you see `Authorization: Bearer xyz...**`

```ini
SOURCE_URL=...
TARGET_URL=...
AUTH_TOKEN=Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6Ik... (paste full token)

```

**Option B: If you see `Cookie: JSESSIONID=...**`

```ini
SOURCE_URL=...
TARGET_URL=...
AUTH_COOKIE=JSESSIONID=123456; OTHER_COOKIE=abc... (paste full cookie string)

```

---

### Step 3: Update `Modules/api_executor.py`

We need to tell the "Muscle" to hold this ID card while making requests.

Update your `api_executor.py` with this code. I have added the **Header Logic**.

```python
import asyncio
import os
from playwright.async_api import async_playwright
from Modules import config

MAX_CONCURRENT_REQUESTS = 50 

# --- NEW: AUTH HELPER ---
def get_auth_headers():
    """Reads credentials from .env and builds the header dict."""
    headers = {
        "Content-Type": "application/json",
        "Accept": "application/json"
    }
    
    # Check for Token
    token = os.getenv("AUTH_TOKEN")
    if token:
        headers["Authorization"] = token

    # Check for Cookie (Some systems use this instead)
    cookie = os.getenv("AUTH_COOKIE")
    if cookie:
        headers["Cookie"] = cookie
        
    return headers
# ------------------------

async def fetch_single_pair(context, test_case, dev_base, prod_base):
    suffix = test_case['url_suffix']
    q_params = test_case.get('query_params', {})
    
    dev_full_url = dev_base.rstrip('/') + suffix
    prod_full_url = prod_base.rstrip('/') + suffix

    result = {
        "test_id": test_case['test_id'],
        "endpoint": test_case['endpoint_original'],
        "params": q_params,
        "dev_status": None,
        "prod_status": None,
        "dev_response": None,
        "prod_response": None,
        "error": None
    }

    try:
        # --- MODIFIED: Pass Headers ---
        my_headers = get_auth_headers()
        
        future_dev = context.get(dev_full_url, params=q_params, headers=my_headers)
        future_prod = context.get(prod_full_url, params=q_params, headers=my_headers)
        
        resp_dev, resp_prod = await asyncio.gather(future_dev, future_prod)

        result['dev_status'] = resp_dev.status
        result['prod_status'] = resp_prod.status

        # Try parsing JSON, fallback to Text
        try: result['dev_response'] = await resp_dev.json()
        except: result['dev_response'] = await resp_dev.text()
            
        try: result['prod_response'] = await resp_prod.json()
        except: result['prod_response'] = await resp_prod.text()

    except Exception as e:
        result['error'] = str(e)
        
    return result

async def run_parallel_tests(test_cases, dev_base_url, prod_base_url):
    results = []
    sem = asyncio.Semaphore(MAX_CONCURRENT_REQUESTS)

    async with async_playwright() as p:
        # --- MODIFIED: Add Extra HTTP Headers to Context ---
        api_context = await p.request.new_context(
            ignore_https_errors=True,
            extra_http_headers=get_auth_headers()
        )
        
        async def sem_task(tc):
            async with sem:
                return await fetch_single_pair(api_context, tc, dev_base_url, prod_base_url)

        tasks = [sem_task(tc) for tc in test_cases]
        
        for future in asyncio.as_completed(tasks):
            results.append(await future)

    return results

```

### ðŸš€ Try it now

1. **Crucial:** Make sure you pasted the valid token/cookie in `.env`. (Note: Tokens expire often, so if it fails after 1 hour, get a fresh one).
2. Run `python Main.py`.

You should now see **200 OK** instead of 401.
